{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N-,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
{$MINSTACKSIZE $00004000}
{$MAXSTACKSIZE $00100000}
{$IMAGEBASE $00400000}
{$APPTYPE GUI}
{$WARN SYMBOL_DEPRECATED ON}
{$WARN SYMBOL_LIBRARY ON}
{$WARN SYMBOL_PLATFORM ON}
{$WARN SYMBOL_EXPERIMENTAL ON}
{$WARN UNIT_LIBRARY ON}
{$WARN UNIT_PLATFORM ON}
{$WARN UNIT_DEPRECATED ON}
{$WARN UNIT_EXPERIMENTAL ON}
{$WARN HRESULT_COMPAT ON}
{$WARN HIDING_MEMBER ON}
{$WARN HIDDEN_VIRTUAL ON}
{$WARN GARBAGE ON}
{$WARN BOUNDS_ERROR ON}
{$WARN ZERO_NIL_COMPAT ON}
{$WARN STRING_CONST_TRUNCED ON}
{$WARN FOR_LOOP_VAR_VARPAR ON}
{$WARN TYPED_CONST_VARPAR ON}
{$WARN ASG_TO_TYPED_CONST ON}
{$WARN CASE_LABEL_RANGE ON}
{$WARN FOR_VARIABLE ON}
{$WARN CONSTRUCTING_ABSTRACT ON}
{$WARN COMPARISON_FALSE ON}
{$WARN COMPARISON_TRUE ON}
{$WARN COMPARING_SIGNED_UNSIGNED ON}
{$WARN COMBINING_SIGNED_UNSIGNED ON}
{$WARN UNSUPPORTED_CONSTRUCT ON}
{$WARN FILE_OPEN ON}
{$WARN FILE_OPEN_UNITSRC ON}
{$WARN BAD_GLOBAL_SYMBOL ON}
{$WARN DUPLICATE_CTOR_DTOR ON}
{$WARN INVALID_DIRECTIVE ON}
{$WARN PACKAGE_NO_LINK ON}
{$WARN PACKAGED_THREADVAR ON}
{$WARN IMPLICIT_IMPORT ON}
{$WARN HPPEMIT_IGNORED ON}
{$WARN NO_RETVAL ON}
{$WARN USE_BEFORE_DEF ON}
{$WARN FOR_LOOP_VAR_UNDEF ON}
{$WARN UNIT_NAME_MISMATCH ON}
{$WARN NO_CFG_FILE_FOUND ON}
{$WARN IMPLICIT_VARIANTS ON}
{$WARN UNICODE_TO_LOCALE ON}
{$WARN LOCALE_TO_UNICODE ON}
{$WARN IMAGEBASE_MULTIPLE ON}
{$WARN SUSPICIOUS_TYPECAST ON}
{$WARN PRIVATE_PROPACCESSOR ON}
{$WARN UNSAFE_TYPE OFF}
{$WARN UNSAFE_CODE OFF}
{$WARN UNSAFE_CAST OFF}
{$WARN OPTION_TRUNCATED ON}
{$WARN WIDECHAR_REDUCED ON}
{$WARN DUPLICATES_IGNORED ON}
{$WARN UNIT_INIT_SEQ ON}
{$WARN LOCAL_PINVOKE ON}
{$WARN MESSAGE_DIRECTIVE ON}
{$WARN TYPEINFO_IMPLICITLY_ADDED ON}
{$WARN RLINK_WARNING ON}
{$WARN IMPLICIT_STRING_CAST ON}
{$WARN IMPLICIT_STRING_CAST_LOSS ON}
{$WARN EXPLICIT_STRING_CAST OFF}
{$WARN EXPLICIT_STRING_CAST_LOSS OFF}
{$WARN CVT_WCHAR_TO_ACHAR ON}
{$WARN CVT_NARROWING_STRING_LOST ON}
{$WARN CVT_ACHAR_TO_WCHAR ON}
{$WARN CVT_WIDENING_STRING_LOST ON}
{$WARN NON_PORTABLE_TYPECAST ON}
{$WARN XML_WHITESPACE_NOT_ALLOWED ON}
{$WARN XML_UNKNOWN_ENTITY ON}
{$WARN XML_INVALID_NAME_START ON}
{$WARN XML_INVALID_NAME ON}
{$WARN XML_EXPECTED_CHARACTER ON}
{$WARN XML_CREF_NO_RESOLVE ON}
{$WARN XML_NO_PARM ON}
{$WARN XML_NO_MATCHING_PARM ON}
{$WARN IMMUTABLE_STRINGS OFF}
{$A8,B-,C+,D+,E-,F-,G+,H+,I+,J-,K-,L+,M-,N-,O+,P+,Q-,R-,S-,T-,U-,V+,W-,X+,Y+,Z1}
{$MINSTACKSIZE $00004000}
{$MAXSTACKSIZE $00100000}
{$IMAGEBASE $00400000}
{$APPTYPE GUI}
{$WARN SYMBOL_DEPRECATED ON}
{$WARN SYMBOL_LIBRARY ON}
{$WARN SYMBOL_PLATFORM ON}
{$WARN SYMBOL_EXPERIMENTAL ON}
{$WARN UNIT_LIBRARY ON}
{$WARN UNIT_PLATFORM ON}
{$WARN UNIT_DEPRECATED ON}
{$WARN UNIT_EXPERIMENTAL ON}
{$WARN HRESULT_COMPAT ON}
{$WARN HIDING_MEMBER ON}
{$WARN HIDDEN_VIRTUAL ON}
{$WARN GARBAGE ON}
{$WARN BOUNDS_ERROR ON}
{$WARN ZERO_NIL_COMPAT ON}
{$WARN STRING_CONST_TRUNCED ON}
{$WARN FOR_LOOP_VAR_VARPAR ON}
{$WARN TYPED_CONST_VARPAR ON}
{$WARN ASG_TO_TYPED_CONST ON}
{$WARN CASE_LABEL_RANGE ON}
{$WARN FOR_VARIABLE ON}
{$WARN CONSTRUCTING_ABSTRACT ON}
{$WARN COMPARISON_FALSE ON}
{$WARN COMPARISON_TRUE ON}
{$WARN COMPARING_SIGNED_UNSIGNED ON}
{$WARN COMBINING_SIGNED_UNSIGNED ON}
{$WARN UNSUPPORTED_CONSTRUCT ON}
{$WARN FILE_OPEN ON}
{$WARN FILE_OPEN_UNITSRC ON}
{$WARN BAD_GLOBAL_SYMBOL ON}
{$WARN DUPLICATE_CTOR_DTOR ON}
{$WARN INVALID_DIRECTIVE ON}
{$WARN PACKAGE_NO_LINK ON}
{$WARN PACKAGED_THREADVAR ON}
{$WARN IMPLICIT_IMPORT ON}
{$WARN HPPEMIT_IGNORED ON}
{$WARN NO_RETVAL ON}
{$WARN USE_BEFORE_DEF ON}
{$WARN FOR_LOOP_VAR_UNDEF ON}
{$WARN UNIT_NAME_MISMATCH ON}
{$WARN NO_CFG_FILE_FOUND ON}
{$WARN IMPLICIT_VARIANTS ON}
{$WARN UNICODE_TO_LOCALE ON}
{$WARN LOCALE_TO_UNICODE ON}
{$WARN IMAGEBASE_MULTIPLE ON}
{$WARN SUSPICIOUS_TYPECAST ON}
{$WARN PRIVATE_PROPACCESSOR ON}
{$WARN UNSAFE_TYPE OFF}
{$WARN UNSAFE_CODE OFF}
{$WARN UNSAFE_CAST OFF}
{$WARN OPTION_TRUNCATED ON}
{$WARN WIDECHAR_REDUCED ON}
{$WARN DUPLICATES_IGNORED ON}
{$WARN UNIT_INIT_SEQ ON}
{$WARN LOCAL_PINVOKE ON}
{$WARN MESSAGE_DIRECTIVE ON}
{$WARN TYPEINFO_IMPLICITLY_ADDED ON}
{$WARN RLINK_WARNING ON}
{$WARN IMPLICIT_STRING_CAST ON}
{$WARN IMPLICIT_STRING_CAST_LOSS ON}
{$WARN EXPLICIT_STRING_CAST OFF}
{$WARN EXPLICIT_STRING_CAST_LOSS OFF}
{$WARN CVT_WCHAR_TO_ACHAR ON}
{$WARN CVT_NARROWING_STRING_LOST ON}
{$WARN CVT_ACHAR_TO_WCHAR ON}
{$WARN CVT_WIDENING_STRING_LOST ON}
{$WARN NON_PORTABLE_TYPECAST ON}
{$WARN XML_WHITESPACE_NOT_ALLOWED ON}
{$WARN XML_UNKNOWN_ENTITY ON}
{$WARN XML_INVALID_NAME_START ON}
{$WARN XML_INVALID_NAME ON}
{$WARN XML_EXPECTED_CHARACTER ON}
{$WARN XML_CREF_NO_RESOLVE ON}
{$WARN XML_NO_PARM ON}
{$WARN XML_NO_MATCHING_PARM ON}
{$WARN IMMUTABLE_STRINGS OFF}
unit uFrmPrincipal;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes,
  System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Objects,
  FMX.TabControl, FMX.StdCtrls, FMX.Edit, FMX.Controls.Presentation,
  FMX.Layouts,
  System.Actions, FMX.ActnList, FMX.ListBox, FMX.MultiView, FMX.ListView.Types,
  FMX.ListView.Appearances, FMX.ListView.Adapters.Base, FMX.ListView, db,
  MultiDetailAppearanceU, System.ImageList, FMX.ImgList, DateUtils,
  FMX.DateTimeCtrls, System.UIConsts, FMX.VirtualKeyboard, FMX.Platform,
  FGX.ActionSheet, System.IOUtils, System.StrUtils, FMX.ComboEdit,
  FMX.ComboTrackBar, FMX.Ani, FMX.Effects, FMX.Filter.Effects,uDatamodule



{$IFDEF ANDROID}
    , FMX.Helpers.Android, FMX.Platform.Android
{$ENDIF}
    ;

type
  TfrmPrincipal = class(TForm)
    tabcPrinc: TTabControl;
    tabPrinc_Login: TTabItem;
    tabPrinc_Home: TTabItem;
    RectLogin: TRectangle;
    ImgLoginLogo: TImage;
    Layout1: TLayout;
    EdtLoginSenha: TEdit;
    StyleBook1: TStyleBook;
    MultiView: TMultiView;
    Rectangle3: TRectangle;
    Image2: TImage;
    ListBox1: TListBox;
    listBoxPaine: TListBoxItem;
    ListBoxLancamento: TListBoxItem;
    ListBoxCategoria: TListBoxItem;
    ListBoxItemPerfil: TListBoxItem;
    tabPrinc_Lancamento: TTabItem;
    RectLancFiltro: TRectangle;
    lblData: TLabel;
    BtnLancamentoVoltaMes: TSpeedButton;
    BtnLancamentoAvancaMes: TSpeedButton;
    Layout6: TLayout;
    Layout7: TLayout;
    lblTotalReceita: TLabel;
    Label10: TLabel;
    Layout8: TLayout;
    lblTotalDespesa: TLabel;
    Label12: TLabel;
    tabPrinc_Categoria: TTabItem;
    tabPrinc_CadCategoria: TTabItem;
    BtnCadCategoriaSalva: TSpeedButton;
    Label15: TLabel;
    EdtCadCategoriaDesc: TEdit;
    LstLancamento: TListView;
    lstCategoria: TListView;
    BtnCadCategoriaExclui: TSpeedButton;
    TabPrinc_Perfil: TTabItem;
    ToolBar5: TToolBar;
    BtnPerfilVolta: TSpeedButton;
    Rectangle7: TRectangle;
    Label16: TLabel;
    Label17: TLabel;
    ListBoxPerfil: TListBox;
    ListBoxItem1: TListBoxItem;
    ListBoxItem3: TListBoxItem;
    tabPrinc_Idiona: TTabItem;
    ToolBar6: TToolBar;
    Label18: TLabel;
    BtnConfigVolta: TSpeedButton;
    BtnConfigSalva: TSpeedButton;
    ListBox3: TListBox;
    ListBoxItem2: TListBoxItem;
    ListBoxItem4: TListBoxItem;
    ListBox4: TListBox;
    ListBoxItem5: TListBoxItem;
    ListBoxItem6: TListBoxItem;
    lblLoginCriaNovaConta: TLabel;
    Layout9: TLayout;
    EdtCadLoginNone: TEdit;
    edtCadLoginSenha: TEdit;
    edtCadLoginConfiSenha: TEdit;
    ToolBar10: TToolBar;
    Label23: TLabel;
    SpeedButton2: TSpeedButton;
    rectBtnAcessar: TRectangle;
    ToolBarInformativa: TToolBar;
    LblTbrInformacao: TLabel;
    TimFechaInformacao: TTimer;
    rectBtnCadUsuario: TRectangle;
    Layout10: TLayout;
    Rectangle1: TRectangle;
    ToolBar11: TToolBar;
    Rectangle11: TRectangle;
    Label36: TLabel;
    BtnLancamentoVolta: TSpeedButton;
    LayListaLanc: TLayout;
    Rectangle10: TRectangle;
    ImgLstLogo: TImageList;
    Label1: TLabel;
    lblSaldoAtual: TLabel;
    RectPerfilLogoff: TRectangle;
    Circle1: TCircle;
    RectPerfilBtnAlterSenha: TRectangle;
    Rectangle8: TRectangle;
    Line3: TLine;
    BtnLancamentoAdd: TSpeedButton;
    fgActCategia: TfgActionSheet;
    TabPrinc_CadLancamento: TTabItem;
    LayLancFiltro: TLayout;
    Layout23: TLayout;
    rectToolBarCadLancamento: TRectangle;
    btnCadLancVoltar: TSpeedButton;
    lblTituloCadLancamento: TLabel;
    actTabPrincipal: TActionList;
    actPrinc_CadLancamento: TChangeTabAction;
    actPrinc_Home: TChangeTabAction;
    actPrinc_Login: TChangeTabAction;
    actTabCadLanc: TActionList;
    actCadLanc_Primaria: TChangeTabAction;
    actCadLanc_Secundaria: TChangeTabAction;
    actPrinc_CadCategoria: TChangeTabAction;
    actPrinc_Categoria: TChangeTabAction;
    imglstIcoBtn: TImageList;
    actPrinc_Lancamento: TChangeTabAction;
    actPrinc_Perfil: TChangeTabAction;
    tabPrinc_Teste: TTabItem;
    btnAcessar: TSpeedButton;
    TabcLogin: TTabControl;
    tabLogin_Logar: TTabItem;
    tabLogin_CadUsuario: TTabItem;
    btnCadastarUsuario: TSpeedButton;
    BtnAlterSenha: TSpeedButton;
    BtnPerfilLogoff: TSpeedButton;
    actTabLogin: TActionList;
    actLogin_Logar: TChangeTabAction;
    actLogin_CadUsuario: TChangeTabAction;
    Image1: TImage;
    lblUsuarioLogin: TLabel;
    Rectangle29: TRectangle;
    rectHomeTop: TRectangle;
    Layout31: TLayout;
    Image5: TImage;
    Layout32: TLayout;
    Layout33: TLayout;
    Rectangle30: TRectangle;
    Layout34: TLayout;
    lblDataAtualtabiHome: TLabel;
    Layout36: TLayout;
    lblSaldoAtualLinhaTempo: TLabel;
    lblSaldoRestanteLinhaTempo: TLabel;
    lblApagarLinhaTempo: TLabel;
    lblAreceberLinhaTempo: TLabel;
    Rectangle31: TRectangle;
    Rectangle32: TRectangle;
    ShadowEffect2: TShadowEffect;
    ShadowEffect3: TShadowEffect;
    lytUltimoLancamento: TLayout;
    Layout37: TLayout;
    Label37: TLabel;
    SpeedButton11: TSpeedButton;
    Label38: TLabel;
    Layout35: TLayout;
    Image3: TImage;
    Image6: TImage;
    Image7: TImage;
    Image8: TImage;
    Line1: TLine;
    Line4: TLine;
    Line5: TLine;
    BlurEffect1: TBlurEffect;
    lstUltimoLanc: TListView;
    imgUltimoLancDespesa: TImage;
    imgUltimoLancReceita: TImage;
    lytBarraInferioTabHome: TLayout;
    Layout3: TLayout;
    Image10: TImage;
    Layout4: TLayout;
    Image11: TImage;
    Layout5: TLayout;
    Image12: TImage;
    Layout2: TLayout;
    imgBtnNovoLancamento: TImage;
    Rectangle2: TRectangle;
    Rectangle4: TRectangle;
    Rectangle12: TRectangle;
    Rectangle13: TRectangle;
    actCadLanc_Novo: TChangeTabAction;
    lstBoxItemDimensao: TListBoxItem;
    Button1: TButton;
    Button2: TButton;
    Button3: TButton;
    rectToolBarHome: TRectangle;
    btnHomeMenu: TSpeedButton;
    Layout14: TLayout;
    Label2: TLabel;
    lblHomeNomeUsuario: TLabel;
    BlurEffect2: TBlurEffect;
    tabcCadLanc: TTabControl;
    tabCadLanc_Novo: TTabItem;
    Layout11: TLayout;
    Layout12: TLayout;
    rectNovaReceita: TRectangle;
    Image14: TImage;
    Label3: TLabel;
    rectNovaDespesa: TRectangle;
    Image13: TImage;
    Label4: TLabel;
    tabCadLanc_Primaria: TTabItem;
    tabCadLanc_Secundaria: TTabItem;
    tabCadLanc_categoria: TTabItem;
    Layout13: TLayout;
    RoundRect1: TRoundRect;
    Rectangle9: TRectangle;
    rectCabecalho: TRectangle;
    lblCabecalhoCadLanc: TLabel;
    edtCadLancDescricao: TEdit;
    Layout16: TLayout;
    edtCadLancValor: TEdit;
    edtCadLancData: TDateEdit;
    edtCadLancCategoria: TEdit;
    Layout19: TLayout;
    lblCadLancPago: TLabel;
    Label7: TLabel;
    Layout20: TLayout;
    Layout21: TLayout;
    Layout25: TLayout;
    Layout26: TLayout;
    swiCadLancPago: TSwitch;
    SwiCadLancRepeti: TSwitch;
    edtCadLancNroParcela: TEdit;
    Layout27: TLayout;
    lstCategoriaCadLanc: TListBox;
    Layout30: TLayout;
    SpeedButton5: TSpeedButton;
    SpeedButton6: TSpeedButton;
    Layout38: TLayout;
    ShadowEffect4: TShadowEffect;
    rectCadLanc_Ontem: TRectangle;
    SpeedButton7: TSpeedButton;
    rectCadLanc_Amanha: TRectangle;
    SpeedButton8: TSpeedButton;
    rectCadLanc_Hoje: TRectangle;
    SpeedButton9: TSpeedButton;
    rectCadLanc_person: TRectangle;
    SpeedButton10: TSpeedButton;
    Layout39: TLayout;
    Layout17: TLayout;
    Rectangle20: TRectangle;
    btnAvancarTabSecundaria: TSpeedButton;
    Layout40: TLayout;
    Layout24: TLayout;
    Rectangle23: TRectangle;
    btnCadLancGravarLanc: TSpeedButton;
    Layout15: TLayout;
    Rectangle19: TRectangle;
    btnSalvarCategoria_CadLanc: TSpeedButton;
    actCadLanc_Categoria: TChangeTabAction;
    btnToolBarNovoCategoria: TSpeedButton;
    Label5: TLabel;
    Rectangle14: TRectangle;
    Layout18: TLayout;
    Label8: TLabel;
    btnCadCategoriaVoltar: TSpeedButton;
    Rectangle6: TRectangle;
    Layout22: TLayout;
    Label9: TLabel;
    btnCategoriaVoltar: TSpeedButton;
    btnCategoriaNova: TSpeedButton;
    procedure ListBoxLancamentoClick(Sender: TObject);
    procedure ListBoxCategoriaClick(Sender: TObject);
    procedure lstCategoriaItemClickEx(const Sender: TObject;
      ItemIndex: Integer; const LocalClickPos: TPointF;
      const ItemObject: TListItemDrawable);
    procedure ListBoxItemPerfilClick(Sender: TObject);
    procedure BtnLancamentoVoltaMesClick(Sender: TObject);
    procedure BtnLancamentoAvancaMesClick(Sender: TObject);
    procedure lblLoginCriaNovaContaClick(Sender: TObject);
    procedure TimFechaInformacaoTimer(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure listBoxPaineClick(Sender: TObject);
    procedure BtnHomeLancDespesaClick(Sender: TObject);
    procedure FormKeyUp(Sender: TObject; var Key: Word; var KeyChar: Char;
      Shift: TShiftState);
    procedure EdtCadLancaValorKeyDown(Sender: TObject; var Key: Word;
      var KeyChar: Char; Shift: TShiftState);
    procedure EdtCadCategoriaDescExit(Sender: TObject);
    procedure BtnLancExcluirClick(Sender: TObject);
    procedure FormCloseQuery(Sender: TObject; var CanClose: Boolean);
    procedure FormCreate(Sender: TObject);
    procedure BtnHomeVoltaMesClick(Sender: TObject);
    procedure BtnHomeAvancaMesClick(Sender: TObject);
    procedure lblBtnContasAreceberClick(Sender: TObject);
    procedure btnCadLancVoltarClick(Sender: TObject);
    procedure SpeedButton4Click(Sender: TObject);
    procedure SpeedButton3Click(Sender: TObject);
    procedure btnCadLanc_OntemClick(Sender: TObject);
    procedure edtCadLancValorKeyDown(Sender: TObject; var Key: Word;
      var KeyChar: Char; Shift: TShiftState);
    procedure BtnHomeLancReceitaClick(Sender: TObject);
    procedure BtnLancamentoVoltaClick(Sender: TObject);
    procedure btnAcessarClick(Sender: TObject);
    procedure btnCadastarUsuarioClick(Sender: TObject);
    procedure BtnPerfilLogoffClick(Sender: TObject);
    procedure BtnPerfilVoltaClick(Sender: TObject);
    procedure SpeedButton2Click(Sender: TObject);
    procedure EdtCadLoginNoneExit(Sender: TObject);
    procedure edtCadLoginSenhaExit(Sender: TObject);
    procedure edtCadLoginConfiSenhaExit(Sender: TObject);
    procedure imgBtnNovoLancamentoClick(Sender: TObject);
    procedure rectNovaReceitaClick(Sender: TObject);
    procedure rectNovaDespesaClick(Sender: TObject);
    procedure lstFormularioCadLancItemClickEx(const Sender: TObject;
      ItemIndex: Integer; const LocalClickPos: TPointF;
      const ItemObject: TListItemDrawable);
    procedure btnAvancarTabSecundariaClick(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure btnCadLancVoltaDataClick(Sender: TObject);
    procedure btnCadLancAvancaDataClick(Sender: TObject);
    procedure btnCadLanc_HojeClick(Sender: TObject);
    procedure btnCadLanc_AmanhaClick(Sender: TObject);
    procedure btnCadLanc_PersonClick(Sender: TObject);
    procedure edtCadLancDataChange(Sender: TObject);
    procedure edtCadLancCategoriaClick(Sender: TObject);
    procedure btnSalvarCategoria_CadLancClick(Sender: TObject);
    procedure btnToolBarNovoCategoriaClick(Sender: TObject);
    procedure btnCadLancGravarLancClick(Sender: TObject);
    procedure edtCadLancDataExit(Sender: TObject);
    procedure edtCadLancValorExit(Sender: TObject);
    procedure edtCadLancDescricaoExit(Sender: TObject);
    procedure btnCadCategoriaVoltarClick(Sender: TObject);
    procedure BtnCadCategoriaSalvaClick(Sender: TObject);
    procedure btnCategoriaNovaClick(Sender: TObject);
    procedure BtnCadCategoriaExcluiClick(Sender: TObject);
    procedure btnCategoriaVoltarClick(Sender: TObject);
    procedure swiCadLancPagoSwitch(Sender: TObject);


  private
    { Private declarations }

    vModulo:              TDataSetState;
    vIdCategoriaEditar:   string;
    vModuloCadCategoria:  TDataSetState;
    vTipoFiltro:          string;
    vMes, vAno:           Integer;
    vTipoLancameto:       string;

//  Variavel Tela cadLancamento:
    vIDcbxCategoria:          array [0 .. 255] of integer;
    vValidaCampoCadLanc:      Boolean;
    vEdtDescCadLanc:          string;
    vEdtVlrCadLanc:           string;
    vEdtDataCadLanc:          string;
    vEdtNroParCadLanc:        string;
    vEdtQuitaCadLanc:         string; //(S/N)
    vEdtCategCadLanc:         string;

    vDetal2DescLstCadLanca:   string;
    vDetal2LstCadLancaVlr:    string;
    vDetal2LstCadLancaDate:   string;
    vDetal2LstCadLancaNroPar: string;
    vDetal2LstCadLancaQuita:  string;
    vDetal2LstCadLancaCateg:  string;



    procedure IniciaNovoLancamento(DC : string);
    procedure LimpavDetal2LstCadLanc;
    procedure ValidaCampoCadLanc;
    procedure SairTelaDescricaoCadLancamento;
    procedure SairTelaValorCadLancamento;
    procedure SairTelaDataCadLancamento;
    procedure EfeitoBtnApagarReceber(Botao: TRectangle);
    procedure EfeitoBtnFiltro(Botaofiltro: TRectangle);
    procedure EnviaLancamentoParaEdicao(LstView1:TListView; indexLst: integer);
    function DataSqlLite(Adata: TDateTime): string;

  public
    { Public declarations }

  procedure MsgInformativaToolb (AMessagem: string);
  function NomeMes(MesNomerico: integer): string;
  function FormateReal(AValorEntrada: string): string;
  function Convert(aValor1,aValor2,ResultTrue,ResultFalse: string): string;

end;
  var
    frmPrincipal: TfrmPrincipal;
    Dm : TDm;

implementation

{$R *.fmx}
uses
  uLogin,uControleDeTela,uDmProcedures,uCadLancamento,uCategoria;


procedure TfrmPrincipal.FormShow(Sender: TObject);
begin
  Dm := TDm.Create(self);

  uControleDeTela.RecebTabPrincipal(tabPrinc_Home);

  if uDmProcedures.ExistUsuarioLogado then
    uControleDeTela.AvancaTela(tabPrinc_Home)
  else
    uControleDeTela.AvancaTela(tabPrinc_Login);
end;


function TfrmPrincipal.Convert(aValor1,aValor2,ResultTrue,ResultFalse: string): string;
begin
  if UpperCase(aValor1) = aValor2 then
    result := ResultTrue
  else
  result := ResultFalse;
end;

procedure TfrmPrincipal.SairTelaDataCadLancamento;
begin
  //vEdtDataCadLanc     := DataSqlLite(edtDataCadLancamernto.Date);
  ValidaCampoCadLanc;
end;

procedure TfrmPrincipal.SairTelaDescricaoCadLancamento;
begin
  //vEdtDescCadLanc     := UpperCase(edtDescricaoCadLanc.Text);
  ValidaCampoCadLanc;
end;

procedure TfrmPrincipal.SairTelaValorCadLancamento;
begin
  //vEdtVlrCadLanc       := edtValorCadLanc.Text;
  ValidaCampoCadLanc;
end;

procedure TfrmPrincipal.Button1Click(Sender: TObject);
var
  altura, largura : integer;
begin
  {$IFDEF ANDROID}
  largura := Screen.Width;
  altura  := Screen.Height;
  {$ENDIF}

  {$IFDEF MSEINDOWS}
  largura := frmPrincipal.Width;
  altura  := frmPrincipal.Height;
  {$ENDIF}
  ListBoxPerfil.ListItems[2].Text := 'Dimensão: '+ IntToStr(largura)+' x '+ IntToStr(altura);
end;



procedure TfrmPrincipal.lblLoginCriaNovaContaClick(Sender: TObject);
begin
  uLogin.IniciarCadastroUsuario;
end;

procedure TfrmPrincipal.ListBoxLancamentoClick(Sender: TObject);
begin
  MultiView.HideMaster;
  //IrParaTela(uAvancaTela.AvancaTela(tabPrinc_Lancamento));
end;

procedure TfrmPrincipal.listBoxPaineClick(Sender: TObject);
begin
  MultiView.HideMaster;
  //IrParaTela(uAvancaTela.AvancaTela(tabPrinc_Home));
end;

procedure TfrmPrincipal.ListBoxItemPerfilClick(Sender: TObject);
begin
  MultiView.HideMaster;
  AvancaTela(TabPrinc_Perfil);
end;

procedure TfrmPrincipal.ListBoxCategoriaClick(Sender: TObject);
begin
  MultiView.HideMaster;
  AvancaTela(tabPrinc_Categoria);
end;

procedure TfrmPrincipal.lstCategoriaItemClickEx(const Sender: TObject;
ItemIndex: Integer; const LocalClickPos: TPointF;
const ItemObject: TListItemDrawable);
begin
  vCadCategriaDesc          := lstCategoria.Items[ItemIndex].Text;
  vCadCategriaId            := lstCategoria.Items[ItemIndex].Detail;
  vCadCategriaInsertUpdate  := dsEdit;
  AvancaTela(tabPrinc_CadCategoria);
end;

procedure TfrmPrincipal.lstFormularioCadLancItemClickEx(const Sender: TObject;
  ItemIndex: Integer; const LocalClickPos: TPointF;
  const ItemObject: TListItemDrawable);
begin
  //ClickLstFormularioCadLanc(ItemIndex);
end;

procedure TfrmPrincipal.MsgInformativaToolb(AMessagem: string);
begin
  ToolBarInformativa.Visible     := true;
  LblTbrInformacao.Text       := AMessagem;
  TimFechaInformacao.Enabled  := true;
end;

function TfrmPrincipal.NomeMes(MesNomerico: integer): string;
begin
  case MesNomerico of
    1:
      result := 'Janeiro';
    2:
      result := 'Fevereiro';
    3:
      result := 'Macço';
    4:
      result := 'Abril';
    5:
      result := 'Maio';
    6:
      result := 'Julho';
    7:
      result := 'Junho';
    8:
      result := 'Agosto';
    9:
      result := 'Setembro';
    10:
      result := 'Outubro';
    11:
      result := 'Novembro';
    12:
      result := 'Dezembro';
  end;
end;


procedure TfrmPrincipal.rectNovaDespesaClick(Sender: TObject);
begin
  vCadLancTipoCreDeb := 'D';
  AvancarTabsCadLancamento(tabCadLanc_Primaria);

end;

procedure TfrmPrincipal.rectNovaReceitaClick(Sender: TObject);
begin
  vCadLancTipoCreDeb := 'C';
  AvancarTabsCadLancamento(tabCadLanc_Primaria);
end;


procedure TfrmPrincipal.btnAvancarTabSecundariaClick(Sender: TObject);
begin
  uCadLancamento.vCadLancDescricao     := edtCadLancDescricao.Text;
  uCadLancamento.vCadLancValor         := edtCadLancValor.Text;
  uCadLancamento.vCadLancData          := edtCadLancData.Text;
  uCadLancamento.vCadLancDescCategoria := edtCadLancCategoria.Text;

  AvancarTabsCadLancamento(tabCadLanc_Secundaria);
end;

procedure TfrmPrincipal.btnCadLancAvancaDataClick(Sender: TObject);
var
  DataEdt: TDate;
begin
  DataEdt := StrToDate(edtCadLancData.Text);
  edtCadLancData.Text := DateToStr(DataEdt + 1);
end;

procedure TfrmPrincipal.btnCadLancGravarLancClick(Sender: TObject);
begin
  SalvarLancamento;
  AvancaTela(tabPrinc_Home);
end;

procedure TfrmPrincipal.btnCadLancVoltaDataClick(Sender: TObject);
var
  DataEdt: TDate;
begin
  DataEdt := StrToDate(edtCadLancData.Text);
  edtCadLancData.Text := DateToStr(DataEdt - 1);
end;

procedure TfrmPrincipal.btnCadLancVoltarClick(Sender: TObject);
begin
  begin
    case tabcCadLanc.TabIndex of
      0:
      begin
        uControleDeTela.ControlTelaVoltaTela
      end;
      1:
      begin
        AvancarTabsCadLancamento(tabCadLanc_Novo);
      end;
      2:
      begin
        AvancarTabsCadLancamento(tabCadLanc_Primaria);
      end;
      3:
      begin
        AvancarTabsCadLancamento(tabCadLanc_Primaria);
      end;
    end;
  end;
end;



procedure TfrmPrincipal.SpeedButton2Click(Sender: TObject);
begin
  EdtLoginSenha.Text := '';
  actLogin_Logar.ExecuteTarget(self);
end;

procedure TfrmPrincipal.SpeedButton3Click(Sender: TObject);
begin
  //uCadLancamento.FechaModoEdicao;

  SairTelaDescricaoCadLancamento;
  //actTabi00.ExecuteTarget(self);
end;

procedure TfrmPrincipal.SpeedButton4Click(Sender: TObject);
begin
  SairTelaValorCadLancamento;
  //actTabi00.ExecuteTarget(self);
end;

procedure TfrmPrincipal.swiCadLancPagoSwitch(Sender: TObject);
begin
  if swiCadLancPago.IsChecked = True then
    lblCadLancPago.Text := 'Pago'
  else
    lblCadLancPago.Text := 'A pagar'
end;

procedure TfrmPrincipal.btnCadLanc_AmanhaClick(Sender: TObject);
begin
  edtCadLancData.Text :=  DateToStr(now()+ 1);
end;

procedure TfrmPrincipal.btnCadLanc_HojeClick(Sender: TObject);
begin
  edtCadLancData.Text :=  DateToStr(now());
end;

procedure TfrmPrincipal.btnCadLanc_OntemClick(Sender: TObject);
begin
  edtCadLancData.Text :=  DateToStr(now()- 1);
end;

procedure TfrmPrincipal.btnCadLanc_PersonClick(Sender: TObject);
begin
  edtCadLancData.SetFocus;
end;


procedure TfrmPrincipal.btnCategoriaNovaClick(Sender: TObject);
begin
  NovaCategoria;
end;

procedure TfrmPrincipal.btnCategoriaVoltarClick(Sender: TObject);
begin
  ControlTelaVoltaTela;
end;

procedure TfrmPrincipal.ValidaCampoCadLanc;
begin
  vValidaCampoCadLanc := false;

  if (vEdtDescCadLanc = '') then
    vDetal2DescLstCadLanca := 'Campo Obrigatorio'
  else
  begin
    vDetal2DescLstCadLanca := '';
    if (vEdtVlrCadLanc = '') then
      vDetal2LstCadLancaVlr := 'Campo Obrigatorio'
    else
      begin
        vDetal2LstCadLancaVlr := '';
        if (vEdtDataCadLanc = '') then
          vDetal2LstCadLancaDate := 'Campo Obrigatorio'
        else
        begin
          vDetal2LstCadLancaDate := '';
          if (vEdtNroParCadLanc = '')  then
            vDetal2LstCadLancaNroPar := 'Campo Obrigatorio'
          else
          begin
            vDetal2LstCadLancaNroPar := '';
            if (vEdtQuitaCadLanc = '') then
              vDetal2LstCadLancaQuita := 'Campo Obrigatorio'
            else
            begin
              vDetal2LstCadLancaQuita := '';
              if (vEdtCategCadLanc = '') then
                vDetal2LstCadLancaCateg := 'Campo Obrigatorio'
              else
              begin
                vDetal2LstCadLancaCateg := '';
                //btnSalvarCadLancaento.Visible := true;
                vValidaCampoCadLanc := true;
              end;
            end;
          end;
        end;
      end;
  end;
end;

procedure TfrmPrincipal.BtnLancExcluirClick(Sender: TObject);
begin
  //Dm.FDQlancamento.Delete;
end;

procedure TfrmPrincipal.BtnPerfilLogoffClick(Sender: TObject);
begin
  uDmProcedures.UpdateUsuarioCadastrado('N');
  uControleDeTela.AvancaTela(tabPrinc_Login);
end;

procedure TfrmPrincipal.BtnPerfilVoltaClick(Sender: TObject);
begin
  uControleDeTela.ControlTelaVoltaTela;
end;

procedure TfrmPrincipal.btnSalvarCategoria_CadLancClick(Sender: TObject);
begin
  vCadLancDescCategoria := lstCategoriaCadLanc.Items[lstCategoriaCadLanc.ItemIndex];
  vCadLancIdCategoria   := IntToStr(integer(lstCategoriaCadLanc.Items.Objects[lstCategoriaCadLanc.ItemIndex]));

  AvancarTabsCadLancamento(tabCadLanc_Primaria);
end;

procedure TfrmPrincipal.btnToolBarNovoCategoriaClick(Sender: TObject);
begin
  if tabcPrinc.ActiveTab = TabPrinc_CadLancamento then
    if tabcCadLanc.ActiveTab = tabCadLanc_categoria then
    begin
      NovaCategoria;
    end;
end;

procedure TfrmPrincipal.BtnHomeVoltaMesClick(Sender: TObject);
begin

  vMes := vMes - 1;
  if vMes = 0 then
  begin
    vMes := 12;
    vAno := vAno - 1;
  end;

end;

procedure TfrmPrincipal.lblBtnContasAreceberClick(Sender: TObject);
begin
  //EfeitoBtnApagarReceber(RectLinhaBtnAreceber);
  //AtualLstContaAbertaTabiHome;
end;


procedure TfrmPrincipal.BtnHomeAvancaMesClick(Sender: TObject);
begin
  vMes := vMes + 1;
  if vMes > 12 then
  begin
    vMes := 1;
    vAno := vAno + 1;
  end;
  //AtualTabiHome;
end;

procedure TfrmPrincipal.BtnHomeLancDespesaClick(Sender: TObject);
begin

  IniciaNovoLancamento('despesa');
  //IrParaTela(uAvancaTela.AvancaTela(TabPrinc_CadLancamento));

end;

procedure TfrmPrincipal.BtnHomeLancReceitaClick(Sender: TObject);
begin
  IniciaNovoLancamento('receita');
  //IrParaTela(uAvancaTela.AvancaTela(TabPrinc_CadLancamento));
end;

procedure TfrmPrincipal.TimFechaInformacaoTimer(Sender: TObject);
begin
  ToolBarInformativa.Visible := false;
  TimFechaInformacao.Enabled := false;
end;

procedure TfrmPrincipal.BtnLancamentoVoltaClick(Sender: TObject);
begin
   //IrParaTela(uAvancaTela.AvancaTela(tabPrinc_Home));
end;

procedure TfrmPrincipal.BtnLancamentoVoltaMesClick(Sender: TObject);
begin
  vMes := vMes - 1;
  if vMes = 0 then
  begin
    vMes := 12;
    vAno := vAno - 1;
  end;
  //AtualLstLacanmentoTabiLancamento;
end;


procedure TfrmPrincipal.BtnLancamentoAvancaMesClick(Sender: TObject);
begin
  vMes := vMes + 1;
  if vMes > 12 then
  begin
    vMes := 1;
    vAno := vAno + 1;
  end;
  //AtualLstLacanmentoTabiLancamento;
end;


procedure TfrmPrincipal.LimpavDetal2LstCadLanc;
begin

  vDetal2DescLstCadLanca   := '';
  vDetal2LstCadLancaVlr    := '';
  vDetal2LstCadLancaDate   := '';
  vDetal2LstCadLancaNroPar := '';
  vDetal2LstCadLancaQuita  := '';
  vDetal2LstCadLancaCateg  := '';

end;


procedure TfrmPrincipal.imgBtnNovoLancamentoClick(Sender: TObject);
begin
  vCadLancInsertUpdate := dsInsert;
  uCadLancamento.IniciaCadLancamento;
  uControleDeTela.AvancaTela(TabPrinc_CadLancamento);
end;

procedure TfrmPrincipal.IniciaNovoLancamento(DC: string);

begin
  if DC = 'despesa' then
  begin
    vTipoLancameto            := 'D';
    lblTituloCadLancamento.Text := 'Lancamento de despesa';
  end
  else
  begin
    vTipoLancameto            := 'C';
    lblTituloCadLancamento.Text := 'Lancamento de receita';
  end;


  vEdtDescCadLanc             := '';
  vEdtVlrCadLanc              := '';
  vEdtDataCadLanc             := '';
  vEdtNroParCadLanc           := '';
  vEdtQuitaCadLanc            := '';
  vEdtCategCadLanc            := '';

  BtnCadCategoriaExclui.Visible  := false;
  LimpavDetal2LstCadLanc;

  vModulo := dsInsert;
end;


function TfrmPrincipal.FormateReal(AValorEntrada: string): string;
begin
  if pos(',', AValorEntrada) > 0 then
    AValorEntrada := StringReplace(AValorEntrada, ',', '', [rfReplaceAll])
  else if pos('.', AValorEntrada) > 0 then
    AValorEntrada := StringReplace(AValorEntrada, '.', '', [rfReplaceAll])
  else
    AValorEntrada := AValorEntrada + '00';

  result := FormatFloat('###0.00', StrToFloat(AValorEntrada) / 100);
end;

procedure TfrmPrincipal.FormCloseQuery(Sender: TObject; var CanClose: Boolean);
begin
  Application.Terminate;
end;

procedure TfrmPrincipal.FormCreate(Sender: TObject);
begin

  LstLancamento.ItemAppearanceObjects.ItemObjects.Image.Visible := true;
  LstLancamento.ItemAppearance.ItemEditAppearance   :=  'MultiDetailItemShowCheck';

  tabcPrinc.TabPosition       := TTabPosition.None;
  tabcPrinc.ActiveTab         := tabPrinc_Login;

  tabcCadLanc.TabPosition     := TTabPosition.None;

  tabcLogin.TabPosition       := TTabPosition.None;
  tabcLogin.ActiveTab         := tabLogin_Logar;

  toolBarInformativa.Visible  := False;

  MultiView.Enabled           := False;

  imgUltimoLancDespesa.Visible  := False;
  imgUltimoLancReceita.Visible  := False;

  frmPrincipal.btnToolBarNovoCategoria.Visible := False;
end;

procedure TfrmPrincipal.FormKeyUp(Sender: TObject; var Key: Word;
var KeyChar: Char; Shift: TShiftState);
{$IFDEF ANDROID}
var
  Fservice: IFMXVirtualKeyboardService;
{$ENDIF}
begin
{$IFDEF ANDROID}
  if (Key = vkHardwareBack) then
  begin
    TPlatformServices.Current.SupportsPlatformService
      (IFMXVirtualKeyboardService, IInterface(Fservice));

    if (Fservice <> nil) and (TVirtualKeyboardState.Visible
      in Fservice.VirtualKeyBoardState) then
    begin
    end
    else if tabcPrinc.ActiveTab = tabPrinc_Home then
    begin
    end;
    if tabcPrinc.ActiveTab = tabPrinc_CadCategoria then
    begin
      Key := 0;
      ControlTelaVoltaTela;
    end;
  end
{$ENDIF}
end;

function TfrmPrincipal.DataSqlLite(Adata: TDateTime): string;
begin
  result := FormatDateTime('dd/mm/yyyy', Adata);
end;


procedure TfrmPrincipal.edtCadLancCategoriaClick(Sender: TObject);
begin
  AvancarTabsCadLancamento(tabCadLanc_Categoria);
end;

procedure TfrmPrincipal.EdtCadCategoriaDescExit(Sender: TObject);
begin
  EdtCadCategoriaDesc.Text := UpperCase(EdtCadCategoriaDesc.Text);
end;



procedure TfrmPrincipal.EdtCadLancaValorKeyDown(Sender: TObject; var Key: Word;
var KeyChar: Char; Shift: TShiftState);
begin
  if not(KeyChar in ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', ','])
  then
    KeyChar := #0;
end;

procedure TfrmPrincipal.edtCadLoginConfiSenhaExit(Sender: TObject);
begin
  if edtCadLoginConfiSenha.Text <> edtCadLoginSenha.text then
    MsgInformativaToolb('Senha nao conferi com a digitada');
end;

procedure TfrmPrincipal.EdtCadLoginNoneExit(Sender: TObject);
begin
  if EdtCadLoginNone.Text = '' then
    MsgInformativaToolb('Informe o nome do usuario');
end;

procedure TfrmPrincipal.edtCadLoginSenhaExit(Sender: TObject);
begin
  if edtCadLoginSenha.Text = '' then
    MsgInformativaToolb('Infrome a senha');
end;

procedure TfrmPrincipal.edtCadLancDataChange(Sender: TObject);
begin
  vCadLancData := edtCadLancData.Text;
  ControleBotaoTabDataCadLanc(edtCadLancData.Text);
end;


procedure TfrmPrincipal.edtCadLancDataExit(Sender: TObject);
begin
  vCadLancData := edtCadLancData.Text;
end;

procedure TfrmPrincipal.edtCadLancDescricaoExit(Sender: TObject);
begin
  vCadLancDescricao := UpperCase(edtCadLancDescricao.text);
end;

procedure TfrmPrincipal.edtCadLancValorExit(Sender: TObject);
begin
  vCadLancValor := UpperCase(edtCadLancValor.Text);
end;

procedure TfrmPrincipal.edtCadLancValorKeyDown(Sender: TObject; var Key: Word;
  var KeyChar: Char; Shift: TShiftState);
begin
If not(keychar in['0'..'9',',',#08]) then
  KeyChar:=#0;
end;

procedure TfrmPrincipal.EfeitoBtnApagarReceber(Botao: TRectangle);
begin

  //RectLinhaBtnAreceber.Fill.Color := $0000;
  //RectLinhaBtnApagar.Fill.Color := $0000;

  Botao.Fill.Color := $FF125C8E;

end;

procedure TfrmPrincipal.EfeitoBtnFiltro(Botaofiltro: TRectangle);
begin

  //RectLinhaBtnAnterior.Fill.Color := $0000;
  //RectLinhaBtnHoje.Fill.Color := $0000;
  //RectLinhaBtnProxino.Fill.Color := $0000;

  Botaofiltro.Fill.Color := $FF125C8E

end;

procedure TfrmPrincipal.EnviaLancamentoParaEdicao(LstView1: TListView; indexLst: integer);
begin
  LimpavDetal2LstCadLanc;
  //CarregaCamposLancamento(LstView1,indexLst);
  //IrParaTela(uAvancaTela.AvancaTela(TabPrinc_CadLancamento));
end;


procedure TfrmPrincipal.btnAcessarClick(Sender: TObject);
begin

   if uLogin.ValidaSenhaUsuario(EdtLoginSenha.Text) then
    begin
      uDmProcedures.UpdateUsuarioCadastrado('S');
      uControleDeTela.AvancaTela(tabPrinc_Home);
    end
    else
    begin
      MsgInformativaToolb('Informe a senha.');
      EdtLoginSenha.SetFocus;
    end;
end;

procedure TfrmPrincipal.btnCadastarUsuarioClick(Sender: TObject);
begin
  uDmProcedures.InsertUsuario;
  EdtLoginSenha.text := '';
  EdtLoginSenha.SetFocus;

  TabcLogin.ActiveTab := tabLogin_Logar;
end;


procedure TfrmPrincipal.BtnCadCategoriaExcluiClick(Sender: TObject);
begin
  dm.DeleterCategoriaDB;
  ControlTelaVoltaTela;
end;

procedure TfrmPrincipal.BtnCadCategoriaSalvaClick(Sender: TObject);
begin
  vCadCategriaDesc := UpperCase(EdtCadCategoriaDesc.Text);
  SalvaCategoria;
  ControlTelaVoltaTela;
end;

procedure TfrmPrincipal.btnCadCategoriaVoltarClick(Sender: TObject);
begin
  if tabcCadLanc.ActiveTab = tabCadLanc_categoria then
    RefreshLstCategoriaCadLanc;

  ControlTelaVoltaTela;
end;

end.
